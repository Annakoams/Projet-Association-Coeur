"use strict";

var donateClicked = document.querySelector(".action-bar-link.action-bar-dropdown");
var donateBtn = document.querySelector(".action-bar-link.action-bar-dropdown .action-bar-button");
var donateBtnHeader = document.querySelector(".global-header-upper .mobile-donate");
var donatePopup = document.querySelector(".action-bar-link.action-bar-dropdown .action-bar-popup");
var donatePopupClose = document.querySelector(".action-bar-popup .action-bar-popup-close");
var donateOnce = document.querySelector(".action-bar-link.action-bar-dropdown .action-bar-popup-btns.once");
var donateMonthly = document.querySelector(".action-bar-link.action-bar-dropdown .action-bar-popup-btns.monthly");
var donateOnceBtn = document.querySelector(".action-bar-link.action-bar-dropdown #donate-once");
var donateMonthlyBtn = document.querySelector(".action-bar-link.action-bar-dropdown #donate-monthly");
var donateAmount = document.querySelectorAll(".action-bar-link.action-bar-dropdown .action-bar-popup-btns.amount input");
var donateMiddleAmount = document.querySelector(".action-bar-link.action-bar-dropdown .action-bar-popup-btns.amount #medium-amount");
var donateMiddleAmountMonthly = document.querySelector(".action-bar-link.action-bar-dropdown .action-bar-popup-btns.amount #medium-amount-monthly");
var donateAmount = document.querySelectorAll(".action-bar-link.action-bar-dropdown .action-bar-popup-btns.amount input");
var donateRealAmount = document.querySelector(".action-bar-link.action-bar-dropdown .action-bar-popup-text .info-real-amount");
var donateFreeAmount = document.querySelector(".action-bar-link.action-bar-dropdown #donation-amount");

function openDonatePopUp() {
  donateBtn.addEventListener("click", function () {
    donatePopup.classList.add("visible");
    donateClicked.classList.add("visible");
  });
  donateBtnHeader.addEventListener("click", function () {
    donatePopup.classList.add("visible", "from-header");
    donateClicked.classList.add("visible");
  });
}

function closeDonatePopUp() {
  donatePopupClose.addEventListener("click", function () {
    donatePopup.classList.remove("visible", "from-header");
    donateClicked.classList.remove("visible");
  });
}

function updatePopUpValues() {
  if (donateOnceBtn.checked) {
    donateOnce.classList.add("visible");
    donateMonthly.classList.remove("visible");
    donateMonthlyBtn.checked = false;
    donateMiddleAmount.click();
  }

  if (donateMonthlyBtn.checked) {
    donateMonthly.classList.add("visible");
    donateOnce.classList.remove("visible");
    donateOnceBtn.checked = false;
    donateMiddleAmountMonthly.click();
  }
}

function updateCheckedValues() {
  if (donateFreeAmount === document.activeElement) {
    donateAmount.forEach(function (input) {
      input.checked = false;
    });
  }
}

openDonatePopUp();
closeDonatePopUp();
updatePopUpValues();

donateOnceBtn.addEventListener("change", function () {
  updatePopUpValues();
});
donateMonthlyBtn.addEventListener("change", function () {
  updatePopUpValues();
});
donateAmount.forEach(function (input) {
  input.addEventListener("click", function (e) {
    // remove checked on all input
    // input.checked = false;
    // only current checked
    e.target.checked = true;
    // show associated text
    // console.log(e.target.previousElementSibling);
    var realValue = e.target.getAttribute("data-real-amout");
    donateRealAmount.innerHTML = realValue + "€";
  });
});

/*
donateFreeAmount.addEventListener("focus", function () {
 updateCheckedValues();
});
*/

donateFreeAmount.addEventListener("keyup", function (e) {
  updateCheckedValues();
  var value = e.target.value;
  var realValue = value / 4;
  if (!Number.isInteger(realValue)) {
    realValue = realValue.toFixed(2);
  }
  donateRealAmount.innerHTML = realValue + "€";
});
